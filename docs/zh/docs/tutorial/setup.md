---
comments: true
---

# å¼€å§‹ä½¿ç”¨

è®©æˆ‘ä»¬å¼€å§‹ä½¿ç”¨å§ã€‚

ä½¿ç”¨fastapi-channelsä¸éœ€è¦ä½ åšä»€ä¹ˆè¿‡å¤šçš„æ“ä½œï¼Œåªéœ€é€šè¿‡ç®€å•çš„å‡ æ­¥å°±å¯ä»¥å¿«é€Ÿå¼€å§‹ä½¿ç”¨ï¼Œå¹¶ä¸”æ–¹ä¾¿çš„å®šåˆ¶ä½ çš„é¢‘é“

```Python
{!> ../../docs_src/setup/tutorial001.py!}
```

å°±åƒä¸Šé¢è¿™æ®µä»£ç è¿™ä¹ˆç®€å•ï¼Œä½ å°±å®ç°äº†ä¸€ä¸ªç®€æ˜“çš„é¢‘é“çš„æ­å»º

æ¥ä¸‹æ¥è®©æˆ‘ä»¬ä»”ç»†è®²ä¸€è®²è¿™ä¸ªä»£ç å§ğŸ˜€

## å…¨å±€æ³¨å†Œfastapi-channels

```Python hl_lines="3 7-12"
{!> ../../docs_src/setup/tutorial001.py!}
```

- *add_exception_handlers è®¾ç½®ä¸ºTrueå°†ä¸ºæˆ‘å°è£…çš„`WebSocketException`æ·»åŠ å¼‚å¸¸æ•è·çš„å¤„ç†æœºåˆ¶ï¼Œå¦‚æœä½ ä¸æƒ³ä½¿ç”¨è¿™ä¸ªå¯ä»¥è®¾ç½®ä¸ºFalseå†è¿›è¡Œè‡ªå®šä¹‰ï¼Œè¯¦ç»†çš„å¼‚å¸¸æœºåˆ¶ä½ å¯ä»¥åœ¨[å¤„ç†é”™è¯¯](exception.md)è¿›è¡Œäº†è§£ã€‚
- *url ä¸ºfastapi-channelsæ·»åŠ å¯¹åº”çš„broadcasteråç«¯åœ°å€ï¼Œä¹Ÿå°±æ˜¯ä½ ç”¨æ¥è¿›è¡Œæ¶ˆæ¯è®¢é˜…çš„åç«¯åº”ç”¨ç¨‹åºçš„åœ°å€ã€‚
- *limiter_url ä¸ºfastapi-channelsæ·»åŠ å¯¹åº”çš„fastapi-limiteråœ°å€ï¼Œè¿™ä¸ªå¯¹åº”ä½ ç”¨æ¥åšé™æµç¼“å­˜çš„redisæ•°æ®åº“ã€‚å¯èƒ½è¿™é‡Œä¹‹åä¼šè¿›è¡Œæ‰©å±•ï¼Œä½†æ˜¯ç°åœ¨è¯·æŒ‰ç…§æˆ‘ä»¬ç»™ä½ æä¾›çš„æ–¹å¼æ¥è®¾ç½®

è¿™äº›åªæ˜¯ç®€å•çš„ä½¿ç”¨,å®é™…ä¸Šä½ è¿˜å¯ä»¥å®šä¹‰ä¸€äº›å…¶ä»–çš„å†…å®¹æ¥å®ç°å…¨å±€åŒ–è®¾ç½®ï¼šé™æµå™¨ã€æƒé™éªŒè¯ã€‚


```python title="fastapi_channels/api.py"
{!> ../../fastapi_channels/api.py[ln:15-39]!}
```

## è‡ªå®šä¹‰çš„èŒƒç•´

ä½ è¿˜å¯ä»¥è‡ªå®šä¹‰<a href="https://github.com/encode/broadcaster" class="external-link" target="_blank">Broadcaster</a>
å’Œ<a href="https://github.com/long2ice/fastapi-limiter" class="external-link" target="_blank">FastAPI-limiter</a>,
å°±è·Ÿå¹³å¸¸ä½¿ç”¨è¿™äº›ä¸€æ ·ï¼ŒæŠŠå®šä¹‰å¥½çš„å¯¹è±¡ä¼ å…¥ï¼Œæˆ–è€…ç›´æ¥å¯¹å¯¹åº”çš„åº“è¿›è¡Œè‡ªä¸»è®¾ç½®

```python title="main.py" hl_lines="13-16 20 27"
{!> ../../docs_src/setup/tutorial002.py!}
```
!!! note
    FastAPILimiterçš„initæ–¹æ³•æ˜¯ä¸ªç±»æ–¹æ³•ï¼Œæ‰€ä»¥æˆ‘è¿™é‡Œæ²¡æœ‰è€ƒè™‘ä¼ å…¥ã€‚
    
    è€Œä¸”ä¸æ­¢è¿™ä¸€ç‚¹ï¼Œå¦‚æœä½ æƒ³è‡ªå·±åœ¨lifespanä¸­æ¥åˆå§‹åŒ–FastAPILimiterï¼Œåƒæ˜¯`app(lifspan=lifspan)`æ˜¯ä¸å¯è¡Œçš„ã€‚

    å› ä¸ºé€šè¿‡add_channelåˆå¹¶äº†fastapi-channelçš„ç”Ÿå‘½å‘¨æœŸå‡½æ•°å’Œfastapiçš„ç”Ÿå‘½å‘¨æœŸå‡½æ•°ï¼Œåˆå¹¶çš„ç»“æœæ˜¯æˆ‘çš„åˆå§‹åŒ–æ­¥éª¤åœ¨fastapiçš„`start_up`ä¹‹å‰

æˆ‘åªæ˜¯æŠŠä»–èšåˆåˆ°ä¸€ä¸ªæ–¹æ³•é‡Œï¼Œåœ¨ä½ ä¸æƒ³å•ç‹¬çš„ä¸€ä¸ªä¸ªæŒ‡å®šçš„æ—¶å€™ï¼Œå¸®ä½ å®Œæˆå…¨å±€æ³¨å†Œå’Œå…³é—­ç¨‹åºçš„åç»­å¤„ç†ã€‚

ä½†æ˜¯è¿˜æ˜¯æœŸæœ›ä½ èƒ½å¤Ÿä½¿ç”¨add_channelæ¥å¸®åŠ©ä½ å®Œæˆfastapi-channelsçš„æ³¨å†Œï¼ŒåŒæ—¶è¿™æ ·ä¸ä½ çš„httpæ¥å£ä¸­ä½¿ç”¨FastAPI-limiterçš„å¹¶ä¸å†²çª

```python hl_lines="7"
{!> ../../docs_src/setup/tutorial003.py!}
```
